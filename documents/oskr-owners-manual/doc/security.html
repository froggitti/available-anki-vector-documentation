<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Security &#8212; OSKR Owner&#39;s Manual</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/agogo.css?v=08520df9" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Example Customization Tasks" href="examples.html" />
    <link rel="prev" title="Vector subsystems" href="vector_subsystems.html" /> 
  </head><body>
    <div class="header-wrapper" role="banner">
      <div class="header">
          <p class="logo"><a href="../index.html">
            <img class="logo" src="../_static/ddl_logo.png" alt="Logo of OSKR Owner&#39;s Manual"/>
          </a></p>
        <div class="headertitle"><a
          href="../index.html">OSKR Owner&#39;s Manual</a></div>
        <div class="rel" role="navigation" aria-label="Related">
          <a href="vector_subsystems.html" title="Vector subsystems"
             accesskey="P">previous</a> |
          <a href="examples.html" title="Example Customization Tasks"
             accesskey="N">next</a> |
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="security">
<h1>Security<a class="headerlink" href="#security" title="Link to this heading">¶</a></h1>
<p>By default the system comes in a somewhat locked down state that
prevents random access by most users to the internals. This section
describes several security features and settings, as well as ways to
modify the settings to fit your needs.</p>
<section id="ble">
<h2>BLE<a class="headerlink" href="#ble" title="Link to this heading">¶</a></h2>
<p>All initial connections to Vector are made via BLE (BlueTooth Low
Energy) connections via the phone app, a client tool, Vector Web
Setup. These all require you to <em>pair</em> the device by entering a code
displayed on the Vector screen.</p>
<p>Due to the limited range of BlueTooth signals and the even more
limited range of being able to see the Vector’s screen this does a
very good job of assuring that the person accessing the Vector is in
physical control of the device. Malicious users from around the world
simply can’t interface with the Vector at this level.</p>
</section>
<section id="securing-ssh">
<h2>Securing SSH<a class="headerlink" href="#securing-ssh" title="Link to this heading">¶</a></h2>
<p>By default the Vector generates a unique SSH user key the first time it
boots and every time you perform a User Data Reset.</p>
<p>SSH works by providing a <em>private key</em> that performs encryption
operations and a <em>public key</em> that allows another person or system to
verify the encryption operations. As the name indicates the <em>private
key</em> should only be given to someone who you want to be able sign in
to the computer and the <em>public key</em> is safe to distribute to anyone
without compromising the private key’s security.</p>
<p>The default configuration is generally secure although you may wish to
take some steps to harden the SSH connection even more.</p>
<section id="adding-a-passphrase-to-your-local-ssh-key">
<h3>Adding a passphrase to your local SSH key<a class="headerlink" href="#adding-a-passphrase-to-your-local-ssh-key" title="Link to this heading">¶</a></h3>
<p>By default the generated SSH key doesn’t have a passphrase and anyone
with access to the file can use it. To add a passphrase:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span><span class="o">-</span><span class="n">keygen</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">f</span> <span class="o">~/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="o">-</span><span class="n">Vector</span><span class="o">-</span><span class="n">X1Y2</span>
</pre></div>
</div>
</section>
<section id="removing-the-private-key-from-vector">
<h3>Removing the private key from Vector<a class="headerlink" href="#removing-the-private-key-from-vector" title="Link to this heading">¶</a></h3>
<p>A user with physical access to Vector can get the private key. Once
you’ve retrieved a copy you no longer need to keep one on the Vector.
Removing the file will prevent a user from being able to download it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">root</span><span class="o">@&lt;</span><span class="n">ROBOT_IP</span><span class="o">&gt;</span>
<span class="n">root</span><span class="nd">@Vector</span><span class="o">-</span><span class="n">U9D5</span><span class="p">:</span><span class="o">~</span><span class="c1"># ls /data/ssh/                  </span>
<span class="n">authorized_keys</span>         <span class="n">id_rsa_Vector</span><span class="o">-</span><span class="n">U9D5</span>      <span class="n">id_rsa_Vector</span><span class="o">-</span><span class="n">U9D5</span><span class="o">.</span><span class="n">pub</span>
<span class="n">root</span><span class="nd">@Vector</span><span class="o">-</span><span class="n">U9D5</span><span class="p">:</span><span class="o">~</span><span class="c1"># rm /data/ssh/id_rsa_Vector-U9D5</span>
<span class="n">root</span><span class="nd">@Vector</span><span class="o">-</span><span class="n">U9D5</span><span class="p">:</span><span class="o">~</span><span class="c1"># ls /data/ssh/</span>
<span class="n">authorized_keys</span>         <span class="n">id_rsa_Vector</span><span class="o">-</span><span class="n">U9D5</span><span class="o">.</span><span class="n">pub</span>
</pre></div>
</div>
<p>If you do this you should backup your local copy of the key. If it is
lost you’ll need to reset User Data to generate a new key and lose any
work on the <code class="docutils literal notranslate"><span class="pre">/data</span></code> partition.</p>
</section>
<section id="removing-the-digital-dream-labs-dev-key">
<h3>Removing the Digital Dream Labs dev key<a class="headerlink" href="#removing-the-digital-dream-labs-dev-key" title="Link to this heading">¶</a></h3>
<p>Digital Dream Labs includes a static SSH key to make internal
development and testing easier. Although we respect users’ privacy and
would never connect to a customer robot there is always the
possibility that the key gets out in the wild where another party can
use it.</p>
<p>To remove the key connect to Vector and open the file
<code class="docutils literal notranslate"><span class="pre">/data/ssh/authorized_keys</span></code> in a text editor. Delete the line that
starts with <code class="docutils literal notranslate"><span class="pre">ssh-rsa</span></code> and ends with <code class="docutils literal notranslate"><span class="pre">digital_dream_labs_dev_key</span></code>.</p>
</section>
</section>
<section id="unsecuring-development-tools">
<h2>Unsecuring Development Tools<a class="headerlink" href="#unsecuring-development-tools" title="Link to this heading">¶</a></h2>
<p>There are several development tools that live behind a firewall on the
robot as they allow any user with access to do a variety of things on
the robot. Since the tools were originally intended for use in a
development environment only they have lower levels of security than
is ideal.</p>
<section id="temporary-access-via-ssh-port-forwarding">
<h3>Temporary access via SSH Port Forwarding<a class="headerlink" href="#temporary-access-via-ssh-port-forwarding" title="Link to this heading">¶</a></h3>
<p>SSH provides options to do <em>Port Forwarding</em> to create tunnels that go
from your computer, over the secure connection, to the system you’re
logging in to. This can be used to get temporary access to a developer
tool. Although not as convenient as permanently changing firewall
rules, when you disconnect the SSH connection security is
automatically restored.</p>
<p>Example accessing the Anim process webViz server:</p>
<ol>
<li><p>SSH in to the device with Port Forwarding options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grant</span><span class="nd">@lord</span><span class="o">-</span><span class="n">humungus</span> <span class="n">otas</span> <span class="o">%</span> <span class="n">ssh</span> <span class="o">-</span><span class="n">L8889</span><span class="p">:</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8889</span> <span class="n">root</span><span class="o">@</span><span class="mf">192.168.1.110</span>
<span class="n">root</span><span class="nd">@Vector</span><span class="o">-</span><span class="n">U9D5</span><span class="p">:</span><span class="o">~</span><span class="c1"># </span>
</pre></div>
</div>
</li>
<li><p>Visit <a class="reference external" href="http://localhost:8889">http://localhost:8889</a> on your computer.</p></li>
</ol>
<p>Multiple ports can be forwarded. Here we forward two webViz
connections:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span>  <span class="o">-</span><span class="n">L8888</span><span class="p">:</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8888</span> <span class="o">-</span><span class="n">L8889</span><span class="p">:</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8889</span>  <span class="n">root</span><span class="o">@&lt;</span><span class="n">ROBOT_IP</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="permanent-access-via-iptables">
<h3>Permanent access via iptables<a class="headerlink" href="#permanent-access-via-iptables" title="Link to this heading">¶</a></h3>
<p>The firewall rules are contained in the files
<code class="docutils literal notranslate"><span class="pre">/etc/iptables/iptables.rules</span></code> and <code class="docutils literal notranslate"><span class="pre">/etc/iptables/ip6tables.rules</span></code>
Most users won’t be running IPv6 will only need to edit the first
file.</p>
<p>The various exposed ports are already listed in the file but are
commented out so they are not loaded by default:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># adb-over-tcp</span>
<span class="c1"># -A INPUT -p tcp -m tcp -m tcp --dport 5555 -j ACCEPT</span>

<span class="c1"># rsync (dev-deployment)</span>
<span class="c1"># -A INPUT -p tcp -m tcp -m tcp --dport 1873 -j ACCEPT</span>

<span class="c1"># webots</span>
<span class="c1"># -A INPUT -p tcp -m tcp --dport 5103 -j ACCEPT</span>
<span class="c1"># -A INPUT -p udp -m udp --dport 5103 -j ACCEPT</span>

<span class="c1"># dev-webservices</span>
<span class="c1"># -A INPUT -p tcp -m tcp -m multiport --dports 8887,8888,8889,8890 -j ACCEPT</span>

<span class="c1"># wwise profiler</span>
<span class="c1"># -A INPUT -p tcp -m tcp -m multiport --dports 24024,24025,24026 -j ACCEPT</span>
<span class="c1"># -A INPUT -p udp --dport 24024 -j ACCEPT</span>
</pre></div>
</div>
<p>To open up a resource permanently:</p>
<ol class="simple">
<li><p>Mark the system filesystem as read/write. <code class="docutils literal notranslate"><span class="pre">mount</span> <span class="pre">-o</span> <span class="pre">remount,rw</span> <span class="pre">/</span></code></p></li>
<li><p>Open the file <code class="docutils literal notranslate"><span class="pre">/etc/iptables/iptables.rules</span></code> in your editor of
choice.</p></li>
<li><p>delete the <code class="docutils literal notranslate"><span class="pre">#</span></code> sign comment from the applicable rule.</p></li>
<li><p>Restart iptables to load the rules: <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">iptables</span></code></p></li>
</ol>
</section>
</section>
<section id="manifest-signing-keys">
<h2>Manifest signing keys<a class="headerlink" href="#manifest-signing-keys" title="Link to this heading">¶</a></h2>
<p>By default Vector has security checks that will only allow an .ota
file that is signed by Digital Dream Labs to be installed. As people
in the community make their own modifications they can make their own
.otas. To be able to install a community-created ota you will need to
whitelist the creator’s signing key. To do so:</p>
<ol class="simple">
<li><p>On your host computer ensure the appropriate directory is created:
<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">root&#64;&lt;ROBOT_IP&gt;</span> <span class="pre">mkdir</span> <span class="pre">/data/etc/ota_keys</span></code></p></li>
<li><p>Obtain and verify the public signing key from the creator of the
OTA.</p></li>
<li><p>Copy the key to vector: <code class="docutils literal notranslate"><span class="pre">scp</span> <span class="pre">new_key.pub</span> <span class="pre">root&#64;&lt;ROBOT_IP&gt;:/data/etc/ota_keys</span></code></p></li>
</ol>
<p>You will now be able to install OTAs signed with this key manually.</p>
<blockquote>
<div><p><strong>WARNING</strong>: An OTA file modifies the entire operating system and has
full control of Vector, and can perform very destructive actions
either intentionally or unintentionally. Only install OTAs from
sources you trust.</p>
</div></blockquote>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          
          <h3>Table of Contents</h3>
          <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Unlocking your Robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="unlock_checklist.html">Checklist</a></li>
<li class="toctree-l1"><a class="reference internal" href="unlock.html">Detailed Unlock Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="filesystem.html">Filesystem layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="vector_subsystems.html">Vector subsystems</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Security</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ble">BLE</a></li>
<li class="toctree-l2"><a class="reference internal" href="#securing-ssh">Securing SSH</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unsecuring-development-tools">Unsecuring Development Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="#manifest-signing-keys">Manifest signing keys</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Example Customization Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="open_source_repositories.html">Open Source Repository List</a></li>
<li class="toctree-l1"><a class="reference internal" href="error_codes.html">Appendix 1: Vector Error Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="vector_maintenance_tasks.html">Appendix 2: Vector Maintenance Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="living_with_windows.html">Appendix 3: Living with Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="cross-compilation.html">Cross-compiling Binaries for Vector</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources.html">Appendix 4: Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

          <search role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="../search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
            </form>
          </search>

        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="Related">
            <a href="vector_subsystems.html" title="Vector subsystems"
              >previous</a> |
            <a href="examples.html" title="Example Customization Tasks"
              >next</a> |
            <a href="../genindex.html" title="General Index"
              >index</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="../_sources/doc/security.md.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
    &#169; Copyright 2020-2021, Digital Dream Labs.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>